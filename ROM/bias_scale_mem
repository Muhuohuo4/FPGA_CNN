module bias_scale_mem #(
    parameter BIAS_WIDTH    = 32,
    parameter SCALE_WIDTH   = 16,
    parameter LAYER_NUM     = 8,
    parameter CH_NUM        = 64
)(
    input  wire                     clk,
    input  wire                     rst,
    input  wire                     start,

    input  wire [4:0]               layer_idx,  // 层编号
    input  wire [9:0]               ch_idx,     // 通道编号
    output reg  [BIAS_WIDTH-1:0]    bias_out,
    output reg  [SCALE_WIDTH-1:0]   scale_out
);
    initial $readmemh("bias.mem", bias_rom);
    initial $readmemh("scale.mem", scale_rom);
    
    localparam TOTAL_NUM = LAYER_NUM * CH_NUM;
    localparam ADDR_WIDTH = $clog2(TOTAL_NUM);  // 比如 8×64=512 → 9bit

    wire [ADDR_WIDTH-1:0] addr;
    assign addr = layer_idx * CH_NUM + ch_idx;    

    // ROM存储
    reg [BIAS_WIDTH-1:0]  bias_rom  [0:TOTAL_NUM-1];
    reg [SCALE_WIDTH-1:0] scale_rom [0:TOTAL_NUM-1];

    initial begin
        $readmemh("bias.mem",  bias_rom);
        $readmemh("scale.mem", scale_rom);
    end

    // 同步读取
    always @(posedge clk) begin
        if (rst) begin
            bias_out  <= 0;
            scale_out <= 0;
        end else begin
            bias_out  <= bias_rom [addr];
            scale_out <= scale_rom[addr];
        end
    end

endmodule
